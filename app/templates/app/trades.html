{% extends 'app/base.html' %}
{% load static %}

{% block title %}Trades{% endblock %}
{% block page_title %}Trades{% endblock %}


{% block content %}

<div class="card" style="width: 32%; float:left;">
  <div class="card-body">
    <h2 class="card-title">Make a trade</h2>
    <!--<h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>-->
    <p class="card-text">
    <div id="make_trade">
      <form id="formCreateTrade">
        <div class="form-group row">
          <div class="col-sm-6">
            <div class="custom-control custom-radio custom-control-inline">
              <input type="radio" id="buy" name="buysell" value="buy" class="custom-control-input"  >
              <label class="custom-control-label" for="buy">Buy</label>
            </div>
            <div class="custom-control custom-radio custom-control-inline">
              <input type="radio" id="sell" name="buysell" value="sell" class="custom-control-input"  checked>
              <label class="custom-control-label" for="sell">Sell</label>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <label for="commodity" class="col-sm-4 col-form-label col-form-label">Commodity:</label>
          <div class="col-sm-6">

            <button type="button" class="btn btn-primary mb-2" data-toggle="modal"
              data-target="#createShare">Share</button>
            <!-- <div id="commodityEntry"></div> -->
            <input type="text" class="form-control form-control" id="commodityEntry" 
            name="commodityEntry" required>
          </div>
        </div>

        <div class="form-group row">
          <label for="tradeWith" class="col-sm-4 col-form-label col-form-label">Trade with:</label>
          <div class="col-sm-8">
            <select class="custom-select" name="tradeWith" id="tradeWith">
              <option selected>Open</option>
            </select>
          </div>
        </div>


        <div class="form-group row">
          <label for="price" class="col-sm-4 col-form-label col-form-label">Price</label>
          <div class="col-sm-8">
            <input type="number" step="0.01" name="price" class="form-control form-control" id="price" required>
          </div>
        </div>

        <div class="form-group row">
          <div class="col-sm-9"></div>
          <div class="col-sm-2">
            <button type="submit" class="btn btn-primary mb-2">Create</button>
          </div>
        </div>

      </form>
    </div>


    </p>
    <!--<a href="#" class="card-link">Card link</a>
    <a href="#" class="card-link">Another link</a>-->
  </div>
</div>

<div id="right-container" style="width:65%; float:right;">

  <div class="card" style="width: 100%;">
    <div class="card-body">
      <h2 class="card-title">Your active trade requests</h2>

      <p class="card-text">

      <div>
        <!-- <ul class="tradeList" id="active_trades">
  </ul> -->

        <table class="table active_trades" id="active_trades">
          <thead>
            <tr>
              <!-- <td scope="col" width="80"></td> -->
              <th scope="col">Commodity</th>
              <th scope="col">Price</th>
              <td scope="col">Seller</td>
              <td scope="col">Buyer</td>
              <td scope="col">Initiated by</td>
              <td scope="col"></td>
            </tr>
          </thead>
          <tbody>
            <tr class="buyHeader tradeHeader buy">
              <td scope="col" colspan=7>Buy</td>
            </tr>
            <tr class="noTradesFound buy">
              <td scope="col" colspan=7>No trades found</td>
            </tr>
            <tr class="sellHeader tradeHeader sell">
              <td scope="col" colspan=7>Sell</td>
            </tr>
            <tr class="noTradesFound sell">
              <td scope="col" colspan=7>No trades found</td>
            </tr>
          </tbody>
        </table>
      </div>

      </p>

    </div>
  </div>



</div>



<div class="card" style="width: 100%; float:left; margin-top:25px">
  <div class="card-body">
    <h2 class="card-title">Trading history</h2>
    <!--<h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>-->
    <p class="card-text">

    <div id="past_trades">
      <table class="table" id="past_trades">
        <thead>
          <tr>
            <td scope="col">Status</td>
            <th scope="col">Commodity</th>
            <th scope="col">Price</th>
            <td scope="col">Seller</td>
            <td scope="col">Buyer</td>
            <td scope="col">Initiated by</td>
            <td scope="col">Last updated</td>

          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>

    </p>
    <!--<a href="#" class="card-link">Card link</a>
    <a href="#" class="card-link">Another link</a>-->
  </div>
</div>


<!-- Modal -->
<div class="modal fade" id="createShare" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Construct Share To Trade</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>

          <div class="form-group row">
            <label for="athlete" class="col-sm-4 col-form-label col-form-label">Athlete:</label>
            <div class="col-sm-8">
              <select class="custom-select" id="athlete">
                <option selected>...</option>
              </select>
            </div>
          </div>


          <div class="form-group row">
            <label for="volume" class="col-sm-4 col-form-label col-form-label">Volume</label>
            <div class="col-sm-8">
              <input type="number" step="0.01" class="form-control" id="volume">
            </div>
          </div>



        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal"
          onclick="createShareFromModal()">Done</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>

{%endblock%}


{% block footer %}


<script type="text/javascript" src="{% static 'js/trading.js' %}"></script>

<script type="text/javascript">
  $(document).ready(function () {
    console.log('Ready');

    reload_all();
    populateTradeWithSelect();
    populateAthletes();



    $("#createShare").on('show.bs.modal', function () {
      populateAthletes();
    });


    $("#formCreateTrade").submit(function (e) {

      e.preventDefault(); // avoid to execute the actual submit of the form.

      var form = $(this);

      var formData = form.serialize();

      console.log(formData);

      $.ajax({
        type: "GET",
        url: '/create_trade/',
        data: formData, // serializes the form's elements.
        success: function (data) {
          if (data.error) {
            display_error(data.error);
          }
        // alert(data); // show response from the php script.
        reload_all();
      }
     });


  });
});
</script>
{% endblock %}