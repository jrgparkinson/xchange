{% extends 'app/base.html' %}
{% load static %}

{% block title %}{{athlete.name }}{% endblock %}


{% block page_title %}{{athlete.name}} ({{athlete.club.name}}) - current value: {{value.current}} 

<span data-toggle="tooltip" data-placement="left" title="Daily change">
{% if value.change == "NaN" %}
{% elif value.change < 0 %}
(<i class="fas fa-caret-down fa-fw" style="color: red;"></i> {{value.change}}%)
{% elif value.change > 0 %}
(<i class="fas fa-caret-up fa-fw" style="color: green;"></i> {{value.change}}%)
{% else %}
(<i class="fas fa-equals fa-fw" data-toggle="tooltip"></i>)
{% endif %}
</span>

{% endblock %}
<!--Hello, {{ user.username }}. <br><br> -->

<!-- General summary of investor's portfolio and trade options <br><br>-->


{% block content %}



<div class="graph" style="width:50%; height:300px;">
    <canvas id="athleteValue"></canvas>
</div>

{%endblock%}

{% block footer %}

<script>

    function addAthleteToGraph(athlete_id) {
        $.ajax({
            type: "GET",
            url: {% url 'retrieve_athlete_value' %},  // URL to your view that serves new info
            data: { "id": athlete_id }
            })
            .done(function (response) {
                // console.log(response);
                if (response.error) {
                    display_error(response.error);
                }
                var ctx = document.getElementById('athleteValue').getContext('2d');
  
                var trade_data_vals = [];
                response.trades.forEach(t => {
                    trade_data_vals.push({x: new Date(t.updated), y:Number(t.price)/Number(t.asset.volume)});
                });

                var trade_dataset = {
                    label: "Trading price per volume",
                    borderColor: "blue",
                    data: trade_data_vals,
                    fill: false,
                    lineTension:0,
                };

                var data = {datasets: [trade_dataset]};

                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: data,
                    options: {
                        scales: {
                            xAxes: [{
                                type: 'time',
                                // distribution: 'series'
                                ticks: {
                                    autoSkip: true,
                                    maxTicksLimit: 10,
                                },
                                // time: timeStep,
                                scaleLabel: {
                                    display: true,
                                    labelString: "Time"
                                },
                            }],
                            yAxes: [
                                {
                                    scaleLabel: {
                                        display: true,
                                        labelString: "Value per volume"
                                    },
                                    ticks: {
                                        beginAtZero: true
                                    }
                                }
                            ]
                        },
                        plugins: {
                            zoom: {
                                zoom: {
                                    enabled: true,
                                    mode: 'y',
                                    speed: 0.05
                                },
                                pan: {
                                    enabled: true,
                                }
                            }
                        }
                    }
                });
            });
        }


    $(document).ready(function () {
        addAthleteToGraph({{ athlete.id }});
    });


</script>

{% endblock %}